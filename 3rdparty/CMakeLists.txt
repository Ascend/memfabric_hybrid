include(ExternalProject)

SET(THIRD_PARTY_DIR ${PROJECT_SOURCE_DIR}/3rdparty/)
set(INSTALL_DIR ${PROJECT_SOURCE_DIR}/output/3rdparty)
set(THIRD_PARTY_CMAKE_ARGS
        -DCMAKE_C_COMPILER=gcc
        -DCMAKE_CXX_COMPILER=g++
        -DCMAKE_C_FLAGS=${CMAKE_C_FLAGS}
        -DCMAKE_C_FLAGS_RELEASE=${CMAKE_C_FLAGS_RELEASE}
        -DCMAKE_C_FLAGS_DEBUG=${CMAKE_C_FLAGS_DEBUG}
        -DCMAKE_CXX_FLAGS=${CMAKE_CXX_FLAGS}
        -DCMAKE_CXX_FLAGS_RELEASE=${CMAKE_CXX_FLAGS_RELEASE}
        -DCMAKE_CXX_FLAGS_DEBUG=${CMAKE_CXX_FLAGS_DEBUG}
        -DCMAKE_BUILD_TYPE=DEBUG
        -DCMAKE_INSTALL_LIBDIR=${INSTALL_DIR}/lib
        -DCMAKE_INSTALL_BINDIR=${INSTALL_DIR}/bin
        -DCMAKE_INSTALL_PREFIX=${INSTALL_DIR}/)
####################################################################
# hcom
####################################################################
message(STATUS "BUILD_HCOM=${BUILD_HCOM}")
if (BUILD_HCOM)
    set(BUILD_TESTS OFF)

    SET(HCOM_CMAKE_ARGS
        ${THIRD_PARTY_CMAKE_ARGS}
        -DCMAKE_DEPENDS_USE_COMPILER=false
        -DCMAKE_BUILD_TYPE=release
        -DCMAKE_INSTALL_LIBDIR=${INSTALL_DIR}/hcom/lib
        -DCMAKE_INSTALL_BINDIR=${INSTALL_DIR}/hcom/bin
        -DCMAKE_INSTALL_PREFIX=${INSTALL_DIR}/hcom)

    EXTERNALPROJECT_ADD(hcom
        URL ${THIRD_PARTY_DIR}/ubs-comm
        CMAKE_ARGS ${HCOM_CMAKE_ARGS}
        LOG_DOWNLOAD On
        LOG_CONFIGURE On
        LOG_BUILD On
        LOG_INSTALL On)

    EXTERNALPROJECT_GET_PROPERTY(hcom SOURCE_DIR)
    EXTERNALPROJECT_GET_PROPERTY(hcom BINARY_DIR)
    SET(HCOM_LIBS_DIR ${BINARY_DIR}/src PARENT_SCOPE)
    SET(HCOM_INCLUDE_DIR ${SOURCE_DIR}/src PARENT_SCOPE)

    MACRO(TARGET_HCOM target)
    ADD_DEPENDENCIES(${target} hcom)
    TARGET_INCLUDE_DIRECTORIES(${target} PUBLIC ${HCOM_INCLUDE_DIR})
    TARGET_LINK_DIRECTORIES(${target} PUBLIC ${HCOM_LIBS_DIR})
    ENDMACRO()

    message(STATUS "HCOM_LIBS_DIR: ${HCOM_LIBS_DIR}")
    message(STATUS "HCOM_INCLUDE_DIR: ${HCOM_INCLUDE_DIR}")

    MACRO(TARGET_HCOM_HEADER_ONLY target)
    ADD_DEPENDENCIES(${target} hcom)
    TARGET_INCLUDE_DIRECTORIES(${target} PUBLIC ${HCOM_INCLUDE_DIR})
    ENDMACRO()
endif()
